pub mod executor;
pub mod printer;

use super::{
    LoxValue,
    TokenType
};

// impl Visitor<String> for AstPrinter: print;
use printer::AstPrinter;

// impl Visitor<Result<LoxValue, (&'static str, (usize, usize))>> for AstExecutor: run;
use executor::AstExecutor;

// attr start: usize;
// attr len: usize;

// trait: Expr;
// autogenerated code

pub trait Expr
{
	fn start(&self) -> usize;
	fn len(&self) -> usize;

	fn print(&self) -> String;
	fn run(&self) -> Result<LoxValue, (&'static str, (usize, usize))>;
}

trait Visitor<I>
{
	fn visit_binary(expr: &Binary) -> I;
	fn visit_grouping(expr: &Grouping) -> I;
	fn visit_literal(expr: &Literal) -> I;
	fn visit_unary(expr: &Unary) -> I;
}

pub struct Binary
{
	pub start: usize,
	pub len: usize,
	pub left: Box<dyn Expr>,
	pub oper: TokenType,
	pub right: Box<dyn Expr>
}

impl Expr for Binary
{
	fn start(&self) -> usize
	{ self.start }
	fn len(&self) -> usize
	{ self.len }

	fn print(&self) -> String
	{ AstPrinter::visit_binary(self) }
	fn run(&self) -> Result<LoxValue, (&'static str, (usize, usize))>
	{ AstExecutor::visit_binary(self) }
}

pub struct Grouping
{
	pub start: usize,
	pub len: usize,
	pub expr: Box<dyn Expr>
}

impl Expr for Grouping
{
	fn start(&self) -> usize
	{ self.start }
	fn len(&self) -> usize
	{ self.len }

	fn print(&self) -> String
	{ AstPrinter::visit_grouping(self) }
	fn run(&self) -> Result<LoxValue, (&'static str, (usize, usize))>
	{ AstExecutor::visit_grouping(self) }
}

pub struct Literal
{
	pub start: usize,
	pub len: usize,
	pub value: LoxValue
}

impl Expr for Literal
{
	fn start(&self) -> usize
	{ self.start }
	fn len(&self) -> usize
	{ self.len }

	fn print(&self) -> String
	{ AstPrinter::visit_literal(self) }
	fn run(&self) -> Result<LoxValue, (&'static str, (usize, usize))>
	{ AstExecutor::visit_literal(self) }
}

pub struct Unary
{
	pub start: usize,
	pub len: usize,
	pub oper: TokenType,
	pub expr: Box<dyn Expr>
}

impl Expr for Unary
{
	fn start(&self) -> usize
	{ self.start }
	fn len(&self) -> usize
	{ self.len }

	fn print(&self) -> String
	{ AstPrinter::visit_unary(self) }
	fn run(&self) -> Result<LoxValue, (&'static str, (usize, usize))>
	{ AstExecutor::visit_unary(self) }
}
