pub mod executor;
pub mod printer;

use super::{
    LoxValue,
    TokenType
};

// impl Visitor<String> for AstPrinter: print;
use printer::AstPrinter;

// impl Visitor<Result<LoxValue, String>> for AstExecutor: run;
use executor::AstExecutor;

// autogenerated code

pub trait Expr
{
	fn print(&self) -> String;
	fn run(&self) -> Result<LoxValue, String>;
}

trait Visitor<I>
{
	fn visit_binary(expr: &Binary) -> I;
	fn visit_grouping(expr: &Grouping) -> I;
	fn visit_literal(expr: &Literal) -> I;
	fn visit_unary(expr: &Unary) -> I;
}

pub struct Binary
{
	pub left: Box<dyn Expr>,
	pub oper: TokenType,
	pub right: Box<dyn Expr>
}

impl Expr for Binary
{
	fn print(&self) -> String
	{ AstPrinter::visit_binary(self) }
	fn run(&self) -> Result<LoxValue, String>
	{ AstExecutor::visit_binary(self) }
}

pub struct Grouping
{
	pub expr: Box<dyn Expr>
}

impl Expr for Grouping
{
	fn print(&self) -> String
	{ AstPrinter::visit_grouping(self) }
	fn run(&self) -> Result<LoxValue, String>
	{ AstExecutor::visit_grouping(self) }
}

pub struct Literal
{
	pub value: LoxValue
}

impl Expr for Literal
{
	fn print(&self) -> String
	{ AstPrinter::visit_literal(self) }
	fn run(&self) -> Result<LoxValue, String>
	{ AstExecutor::visit_literal(self) }
}

pub struct Unary
{
	pub oper: TokenType,
	pub expr: Box<dyn Expr>
}

impl Expr for Unary
{
	fn print(&self) -> String
	{ AstPrinter::visit_unary(self) }
	fn run(&self) -> Result<LoxValue, String>
	{ AstExecutor::visit_unary(self) }
}
